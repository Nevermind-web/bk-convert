<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<title>BK Convert</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- FFmpeg WASM -->
<script src="https://unpkg.com/@ffmpeg/ffmpeg@0.12.6/dist/ffmpeg.min.js"></script>

<style>
:root{
  --bg:#050816;
  --card:#0f172a;
  --text:#e5e7eb;
  --muted:#94a3b8;
  --accent:#38bdf8;
  --accent2:#a78bfa;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,Inter,sans-serif;
  background:
    radial-gradient(800px at 10% 10%,rgba(56,189,248,.18),transparent),
    radial-gradient(800px at 90% 20%,rgba(167,139,250,.18),transparent),
    linear-gradient(180deg,#050816,#0b1220);
  color:var(--text);
  min-height:100vh;
}
@keyframes fadeUp{from{opacity:0;transform:translateY(20px)}to{opacity:1}}
.wrapper{
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  padding:40px;
}
.app{
  width:100%;
  max-width:1100px;
  background:rgba(15,23,42,.9);
  backdrop-filter:blur(18px);
  border-radius:28px;
  padding:44px;
  box-shadow:0 40px 100px rgba(0,0,0,.6);
  animation:fadeUp .8s ease;
}
header{display:flex;justify-content:space-between;align-items:center}
h1{margin:0;font-size:34px}
.subtitle{font-size:14px;color:var(--muted)}

.tabs{
  display:flex;
  gap:14px;
  margin:30px 0;
}
.tab{
  flex:1;
  padding:16px;
  border-radius:16px;
  background:#020617;
  border:1px solid rgba(255,255,255,.08);
  text-align:center;
  cursor:pointer;
  transition:.25s;
}
.tab:hover{transform:translateY(-2px)}
.tab.active{border-color:var(--accent)}
.tab.locked{opacity:.35;cursor:not-allowed}

.drop{
  padding:70px;
  border-radius:24px;
  border:2px dashed rgba(255,255,255,.15);
  text-align:center;
  cursor:pointer;
  transition:.25s;
}
.drop:hover{border-color:var(--accent)}
.drop span{display:block;margin-top:10px;color:var(--muted)}

.controls{
  margin-top:30px;
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:20px;
}
select,button{
  padding:16px;
  border-radius:14px;
  border:none;
  font-size:15px;
}
select{
  background:#020617;
  color:var(--text);
}
button{
  background:linear-gradient(135deg,var(--accent),var(--accent2));
  color:#020617;
  font-weight:800;
  cursor:pointer;
}
button:disabled{opacity:.4;cursor:not-allowed}

.notice{
  margin-top:22px;
  text-align:center;
  color:var(--muted);
  font-size:14px;
}
footer{
  margin-top:30px;
  display:flex;
  justify-content:space-between;
  font-size:13px;
  color:var(--muted);
}
.logo{
  position:fixed;
  right:24px;
  bottom:24px;
  font-weight:900;
  opacity:.6;
}
</style>
</head>

<body>
<div class="wrapper">
<div class="app">

<header>
  <div>
    <h1>BK Convert</h1>
    <div class="subtitle">Image & Video Converter</div>
  </div>
</header>

<div class="tabs">
  <div class="tab active" id="imgTab">üñºÔ∏è Obr√°zky</div>
  <div class="tab" id="vidTab">üé¨ Video soubor</div>
  <div class="tab locked" title="Vy≈æaduje server">üîê Creator</div>
</div>

<div class="drop" onclick="fileInput.click()">
  <strong>P≈ôet√°hni soubory nebo klikni</strong>
  <span id="dropInfo"></span>
  <input type="file" id="fileInput" multiple hidden>
</div>

<div class="controls">
  <select id="format"></select>
  <button onclick="convert()">P≈ôev√©st</button>
</div>

<div class="notice" id="notice"></div>

<footer>
  <div>Funguje 100 % na GitHub Pages</div>
  <div>Powered by <b>Nevermind web</b></div>
</footer>

</div>
</div>

<div class="logo">BK</div>

<script>
/* ====== STATE ====== */
const isOnline = location.protocol !== "file:";
let mode = "image";
let files = [];

const imgFormats = ["jpg","png","webp","bmp"];
const vidFormats = ["mp4","webm","avi","mov","mkv"];

const { createFFmpeg, fetchFile } = FFmpeg;
const ffmpeg = createFFmpeg({ log:false });

fileInput.onchange = e => files = [...e.target.files];

imgTab.onclick = () => setMode("image");
vidTab.onclick = () => setMode("video");

/* ====== UI ====== */
function setMode(m){
  if(m==="video" && !isOnline){
    notice.textContent = "Video konverze vy≈æaduje HTTPS (GitHub Pages).";
    return;
  }
  mode = m;
  imgTab.classList.toggle("active", m==="image");
  vidTab.classList.toggle("active", m==="video");
  populateFormats();
  notice.textContent = "";
}

function populateFormats(){
  format.innerHTML = "";
  const list = mode==="image" ? imgFormats : vidFormats;
  list.forEach(f=>{
    const o = document.createElement("option");
    o.value = f;
    o.textContent = f.toUpperCase();
    format.appendChild(o);
  });
}

function init(){
  dropInfo.textContent = isOnline
    ? "Obr√°zky i videa ‚Ä¢ batch podpora"
    : "Offline re≈æim ‚Ä¢ pouze obr√°zky";
  populateFormats();
}
init();

/* ====== CONVERT ====== */
async function convert(){
  if(!files.length) return alert("Vyber soubory");
  const target = format.value;

  if(mode==="image"){
    files.forEach(file=>{
      const img = new Image();
      img.src = URL.createObjectURL(file);
      img.onload = ()=>{
        const c = document.createElement("canvas");
        c.width = img.width;
        c.height = img.height;
        const ctx = c.getContext("2d");
        ctx.fillStyle = "#fff";
        ctx.fillRect(0,0,c.width,c.height);
        ctx.drawImage(img,0,0);
        download(c.toDataURL("image/"+target,0.95), file.name, target);
      };
    });
  } else {
    if(!ffmpeg.isLoaded()) await ffmpeg.load();
    for(const file of files){
      ffmpeg.FS("writeFile","in",await fetchFile(file));
      await ffmpeg.run("-i","in","out."+target);
      const data = ffmpeg.FS("readFile","out."+target);
      download(
        URL.createObjectURL(new Blob([data.buffer])),
        file.name,
        target
      );
      ffmpeg.FS("unlink","in");
      ffmpeg.FS("unlink","out."+target);
    }
  }
}

function download(url, name, format){
  const a = document.createElement("a");
  a.href = url;
  a.download = name.replace(/\.[^/.]+$/,"")+"."+format;
  a.click();
}
</script>
</body>
</html>
